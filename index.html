<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <title>reveal-md</title>
        <link rel="stylesheet" href="./css/reveal.css">
        <link rel="stylesheet" href="./_assets/style.css" id="theme">
        <link rel="stylesheet" href="./css/highlight/github.css">
        <link rel="stylesheet" href="./css/print/paper.css" type="text/css" media="print">


    </head>
    <body>

        <div class="reveal">
            <div class="slides"><section  data-markdown><script type="text/template">

<!-- .slide: data-background-color="#673399" -->
<h1 class="title dark-background"><span class="translucent">React App</span> Performance Tuning</h1>
<h2 class="subtitle">Jason Lengstorf + Sara Vieira <br>+ Sia Karamalegos</h2>
</script></section><section  data-markdown><script type="text/template">
## Meet the speakers
</script></section><section  data-markdown><script type="text/template">

## introduce yourself to your neighbors

<aside class="notes"><p>Suggest pair programming and give them an opportunity to change seats.</p>
</aside></script></section><section  data-markdown><script type="text/template">
## Let’s look at our app

https://github.com/jlengstorf/advanced-react-perf?

<aside class="notes"><p>Steps in this workshop:</p>
<ol>
<li>Assessing an existing React app (60m)
Install <code>webpack-bundle-analyzer</code> to see what’s in the bundle
DevTools (lighthouse) to see how it performs now — mention webpagetest.org
Review webpack config (e.g. production bundles, analyzer, etc.)
Add terser
Show difference in React/React DOM bundle sizes after turning on production mode
CSS minification — have configured but commented out
Gzip/brotli — have configured but commented out</li>
<li>Diagnosing performance problems &amp; prioritizing highest-impact solution (15m)
Workshop w/the class. Outcome needs to match the list of fixes we want to implement. :)
Identify and walk through low-hanging fruit</li>
<li>Lazy loading resources &amp; components with React.lazy and Suspense (40m)
Set up the Router to use React.lazy and Suspense
Use React.lazy to load Code Mirror
Show how this creates code splitting and explain what that means</li>
<li>Leveraging service workers for performance (30m)
<a href="https://developers.google.com/web/tools/workbox/guides/codelabs/webpack">https://developers.google.com/web/tools/workbox/guides/codelabs/webpack</a></li>
<li>Seamlessly preloading and prefetching assets (35m)
Let’s preload fonts
Set up preloading for Dank Mono files
Font-display: swap
Move Google Fonts to HTML vs. @import
Set up preconnect for Google Fonts (Montserrat)
Discuss the trade-offs of using local Google Fonts vs. hosted fonts (e.g. cache)
Don’t use icon fonts; use SVGs (react-icons)</li>
<li>The future of fonts (10m)
Explain what subfont is; don’t actually do it
You can do this in Gatsby or locally
Talk about font variants</li>
<li>Automatically optimizing images (20m)
We can add svgo <a href="https://github.com/rpominov/svgo-loader">https://github.com/rpominov/svgo-loader</a>
<a href="https://www.npmjs.com/package/imagemin-webpack-plugin">https://www.npmjs.com/package/imagemin-webpack-plugin</a></li>
<li>Mitigating the performance impact of third-party scripts (45m)
Use request blocking to show how big an impact a given script
Performance tab, click the “reload” button to get an initial load
Block reqeusts to domain(s) using devtools
Click the “reload” perf button again to get a new measurement
You can now compare between the two loads to see the difference
Show the secret menu (press shift six times in the “experiments” settings tab)
Add a Twitter embed; break the script load to <em>not</em> be async
Refactor to be async; show before and after on the network timeline
Can we find that site that couldn’t get GDPR compliance and shipped a WAY better website to the EU?
Show how to use the “show third-party badges” thing in Chrome DevTools</li>
<li>Using psychology to make an app feel faster than it actually is (30m)
Fancy loaders make people think things are faster
Leave blank (no loader)
Add a loader
Staged loading (don’t block the render)</li>
</ol>
<p>Things we didn’t promise that should probably be solved:
Refactor to use date-fns instead of Moment to show how much smaller the bundle can be
Add lodash to the chart reducer to show how to make sure we’re only including what we actually use</p>
</aside></script></section><section  data-markdown><script type="text/template">
## Why's my app so slow???
</script></section><section  data-markdown><script type="text/template">
## Contents

1. Lazy-loading resource and components
2. Caching with service workers
3. Latency and resource hints
4. Optimizing images
5. Script execution costs
6. Perceived performance
</script></section><section  data-markdown><script type="text/template">
# Lazy-loading resource and components
</script></section><section  data-markdown><script type="text/template">
# Caching with service workers
</script></section><section  data-markdown><script type="text/template">
# Latency and resource hints
</script></section><section  data-markdown><script type="text/template"><img src="./images/resource-hints.jpg_large" alt="Resource hints cheatsheet find pdf at https://storage.googleapis.com/resource-hints/resource-hints-cheatsheet.pdf" />

<small>https://twitter.com/addyosmani/status/743571393174872064?lang=en</small>

<aside class="notes"><p>pdf version of this is in the replies to this tweet</p>
</aside></script></section><section  data-markdown><script type="text/template">
## Latency Case Study: Fonts

```css
@import url('https://fonts.googleapis.com/css?family=Open+Sans|Muli');

h1 {
  font-family: 'Open Sans', sans-serif;
}

p {
  font-family: 'Muli', sans-serif;
}
```
</script></section><section  data-markdown><script type="text/template">
## Loading Google Fonts from CSS

<img src="./images/webfonts_css.png" alt="Google fonts load waterfall showing wasted time from CSS">
</script></section><section  data-markdown><script type="text/template">
## Loading Google Fonts from HTML

```html
<link href="https://fonts.googleapis.com/css?family=Muli:400"
      rel="stylesheet">
```

<img src="./images/webfonts_before.png" alt="Google fonts load waterfall showing wasted latency time">
</script></section><section  data-markdown><script type="text/template">
## Google Fonts with preconnect!

```html
<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
<link href="https://fonts.googleapis.com/css?family=Muli:400"
      rel="stylesheet">
```

<img src="./images/webfonts_preconnect.png" alt="Google fonts load waterfall showing preconnect">
</script></section><section  data-markdown><script type="text/template">
## Webfonts

<ul class="plus-minus">
  <li class="plus">Hosted on fast and reliable CDNs</li>
  <li class="plus">Can provide optimized variants based on user's browser</li>
  <li class="plus">Opportunity for shared caching on popular fonts</li>
  <li class="minus">Minumum of 2 separate requests</li>
  <li class="minus">Can't use resource hints on the font file</li>
  <li class="minus">Doesn't take advantage of HTTP2 multiplexing</li>
  <li class="minus">No control over FOUT or FOIT</li>
</ul>
</script></section><section  data-markdown><script type="text/template">
## Self-hosted fonts

```html
<link as="font" type="font/woff2"
  href="./fonts/muli-v12-latin-regular.woff2" crossorigin>

<link as="font" type="font/woff2"
  href="./fonts/muli-v12-latin-700.woff2" crossorigin>
```
<img src="./images/no-preload.png" alt="Self-hosted waterfall showing no preload">

<aside class="notes"><p>This alone does not fix perf problem.</p>
</aside></script></section><section  data-markdown><script type="text/template">
## Preloading self-hosted fonts

```html
<link rel="preload" as="font" type="font/woff2"
  href="./fonts/muli-v12-latin-regular.woff2" crossorigin>

<link rel="preload" as="font" type="font/woff2"
  href="./fonts/muli-v12-latin-700.woff2" crossorigin>
```

<img src="./images/font_preload.png" alt="Self-hosted waterfall showing preload">

<small>Note that `preload` loads a resource whether used or not. Only preload resources that are needed on a particular page. Don't self-host popular webfonts like Open Sans or Roboto (sabotages caching).</small>

<aside class="notes"><p><code>rel=&quot;preload&quot;</code> tells the browser to declaratively fetch the resource but not “execute” it (our CSS will queue usage). <code>as=&quot;font&quot;</code> tells the browser what it will be downloading so that it can set an appropriate priority. Without it, the browser would set a default low priority. <code>type=&quot;font/woff2</code> tells the browser the file type so that it only downloads the resource if it supports that file type. <code>crossorigin</code> is required because fonts are fetched using anonymous mode CORS.</p>
</aside></script></section><section  data-markdown><script type="text/template">
# Optimizing images
</script></section><section  data-markdown><script type="text/template">
# Script execution costs
</script></section><section  data-markdown><script type="text/template">
# Perceived performance
</script></section><section  data-markdown><script type="text/template">
<!-- .slide: data-background-color="#673399" -->
<h1 class="title dark-background">Thanks!</h1>
<!-- Slides, resources, and more at <a href="https://bit.ly/siaspeaks" class="dark-background">bit.ly/siaspeaks</a> -->
</script></section></div>
        </div>

        <script src="./lib/js/head.min.js"></script>
        <script src="./js/reveal.js"></script>

        <script>
            function extend() {
              var target = {};
              for (var i = 0; i < arguments.length; i++) {
                var source = arguments[i];
                for (var key in source) {
                  if (source.hasOwnProperty(key)) {
                    target[key] = source[key];
                  }
                }
              }
              return target;
            }

            // Optional libraries used to extend on reveal.js
            var deps = [
              { src: './lib/js/classList.js', condition: function() { return !document.body.classList; } },
              { src: './plugin/markdown/marked.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
              { src: './plugin/markdown/markdown.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
              { src: './plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
              { src: './plugin/zoom-js/zoom.js', async: true },
              { src: './plugin/notes/notes.js', async: true },
              { src: './plugin/math/math.js', async: true }
            ];

            // default options to init reveal.js
            var defaultOptions = {
              controls: true,
              progress: true,
              history: true,
              center: true,
              transition: 'default', // none/fade/slide/convex/concave/zoom
              dependencies: deps
            };

            // options from URL query string
            var queryOptions = Reveal.getQueryHash() || {};

            var options = {};
            options = extend(defaultOptions, options, queryOptions);
        </script>


        <script>
          Reveal.initialize(options);
        </script>
    </body>
</html>
